(function(){var $C=YAHOO.util.Connect;var $D=YAHOO.util.Dom;var $E=YAHOO.util.Event;var _4=YAHOO.util.KeyListener;var _5=YAHOO.env.ua.ie;var _6=(_5==6);var _7=YAHOO.env.ua.gecko;var _8=YAHOO.env.ua.webkit;var _9=YAHOO.env.ua.opera;var _a=YAHOO.lang.isString;var _b=YAHOO.lang.trim;MT.app.Deal={refresh:function(_c){var _d=60;var _e=5;var _f=300;var _10=$D.get("deal-timeleft");var _11=$D.get("deal-status");var _12=$D.get("counter");var _13=$D.get("counter-hour");var _14=$D.get("counter-minute");var _15=$D.get("counter-second");if($D.hasClass(_10,"deal-off")){return;}var _16=_10.getAttribute("diff");countTime(_16);var _17=window.setInterval(check,_d*1000);function check(){$C.asyncRequest("GET",_c,{success:function(o){handleResponse(o);},failure:function(o){}});}function handleResponse(o){var res=MT.util.getEvalRes(o);if(res.status){if(res.data["open"]){_11.innerHTML=res.data["html"];}else{window.location.reload();return;}}window.clearInterval(_17);if(_d<_f){_d+=_e;}_17=window.setInterval(check,_d*1000);}function countTime(){if(_16<1){window.location.reload();return;}var day=parseInt(_16/(60*60*24),10);var _1d=parseInt((_16/(60*60))%24,10);var _1e=parseInt((_16/60)%60,10);var _1f=parseInt(_16%60,10);var _20=[];if(day>0){_20.push("<li><span>"+day+"</span>\u5929</li>");_20.push("<li><span>"+_1d+"</span>\u5c0f\u65f6</li>");_20.push("<li><span>"+_1e+"</span>\u5206\u949f</li>");}else{_20.push("<li><span>"+_1d+"</span>\u5c0f\u65f6</li>");_20.push("<li><span>"+_1e+"</span>\u5206\u949f</li>");_20.push("<li><span>"+_1f+"</span>\u79d2</li>");}_12.innerHTML=_20.join("");_16--;window.setTimeout(countTime,1000);}},toggle:function(_21,_22){_21=$D.get(_21);_22=$D.get(_22);$E.on(_21,"click",function(e){_22.style.display=$D.getStyle(_22,"display")=="none"?"block":"none";});},toggleOtherShare:function(_24){var _25=$D.get("deal-share-im");var _26=$D.get("deal-share-im-c");var _27=$D.get("sidebar");$E.on(_25,"click",function(e){var _29=$D.getStyle(_26,"display")=="none";_26.style.display=_29?"block":"none";if(_24){_27.style.marginTop=_29?"70px":"0px";}});},mailto:function(el){el=$D.get(el);var _2b=el.getAttribute("href");var _2c=_2b.match(/\?subject=(.+)&body/)[1];var _2d=_2b.match(/&body=(.+)/)[1];$E.on(el,"click",function(e){try{var _2f=new ActiveXObject("Outlook.Application");var _30=_2f.getNameSpace("MAPI");var _31=_2f.CreateItem(0);$E.stopEvent(e);_31.Subject=_2c;_31.To="";_31.HTMLBody=_2d;_31.Display(0);}catch(e){}});},buy:function(_32,_33){var _34=$D.get("deal-buy-quantity-input");var _35=$D.get("deal-buy-quantity-login");var _36=$D.get("deal-buy-quantity-signup");var _37=_5?"propertychange":"change";function showError(_38){MT.widget.showMessage("error",_38);}function setValue(el,_3a){if(el){el.value=_3a;}}function canBuy(e,_3c){var _3d=parseInt(_34.value,10);if(!_34.value){if(_3c){showError("\u8d2d\u4e70\u6570\u91cf\u4e0d\u80fd\u4e3a\u7a7a");}return false;}else{if(!/^[0-9]+$/.test(_34.value)){showError("\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u8d2d\u4e70\u6570\u91cf");return false;}}if(_32){if(_3d>_32){showError("\u672c\u5355\u53ea\u5269 "+_32+" \u4ef6\u4e86");return false;}}if(_33){if(_3d>_33){var str="\u4f60\u6700\u591a\u80fd\u8d2d\u4e70 "+_33+" \u4ef6";showError(str);_34.focus();return false;}}return true;}function fixNumber(_3f){var str=_3f+"";var _41=/\d+\.\d+/;if(_41.test(str)){return Number(_3f).toFixed(2);}else{return _3f;}}function check(e){if(!canBuy(e)){return;}MT.widget.removeMessage();var _43=parseInt(_34.value,10);var _44=$D.get("deal-buy-price").innerHTML;var _45=_43*_44;var _46=$D.get("deal-buy-delivery-fee");var _47=parseFloat($D.get("cardcode-row-t").innerHTML);var _48=_45-_47;if(_46){_48+=parseInt(_46.innerHTML,10);}$D.get("deal-buy-total").innerHTML=fixNumber(_45);$D.get("deal-buy-total-t").innerHTML=fixNumber(_48);setValue(_35,_43);setValue(_36,_43);}$E.on("deal-buy-update","click",function(e){$E.stopEvent(e);check(e);});$E.on(_34,"keyup",function(e){if(_34.value==""){return;}check(e);});$E.on(_34,"blur",function(e){if(canBuy(e)){MT.widget.removeMessage();}});$E.on(["deal-buy-form","deal-buy-form-login","deal-buy-form-signup"],"submit",function(e){$E.stopEvent(e);if(!canBuy(e,true)){return;}if($D.get("address-table")&&!MT.app.Deal.address.check()){return;}var _4d=parseInt(_34.value,10);setValue(_35,_4d);setValue(_36,_4d);this.submit();});$E.on("deal-buy-mobile",_37,function(e){$D.get("deal-buy-mobile-input").disabled=!this.checked;});var _4f=$D.get("deal-buy-cardcode");var _50=$D.get("deal-buy-cardcode-login");var _51=$D.get("deal-buy-cardcode-signup");var _52=$D.get("cardcode-text");var _53=$D.get("cardcode-deal");var _54=$D.get("cardcode-verify");var _55=$D.get("cardcode-link");$E.on(_55,"click",function(e){_55.blur();var el=$D.get("cardcode-link-t");var _58=$D.getStyle(el,"display")=="none";el.style.display=_58?"block":"none";if(_58){window.setTimeout(function(){_52.focus();},0);}});$E.on(_54,"click",function(e){if($D.hasClass(_54,"loading")){return;}var _5a=_52.value;var _5b="cardcode="+_5a+"&dealid="+_53.value;var _5c=$C.asyncRequest("POST","/card/check",{success:function(o){var res=MT.util.getEvalRes(o);if(res.status){_54.style.visibility="hidden";_52.disabled=true;$D.addClass(_52,"readonly");$D.get("cardcode-row").style.display="";$D.get("cardcode-row-t").innerHTML=res.data;$D.get("cardcode-row-n").innerHTML=_5a;setValue(_4f,_5a);setValue(_50,_5a);setValue(_51,_5a);check(e);}else{showError(res.msg);_54.value="\u786e\u5b9a";}$D.removeClass(_54,"loading");_54.disabled=false;},failure:function(o){}},_5b);if($C.isCallInProgress(_5c)){$D.addClass(_54,"loading");_54.disabled=true;_54.blur();}});},check:function(){if(_5){fixLableImage();}function fixLableImage(){$E.on(["check-alipay-l","check-chinabank-l"],"click",function(e){$D.get(this.parentNode.htmlFor).checked=true;});}},removeGuide:function(){$E.on("sysmsg-guide-close","click",function(e){var _62=this;$E.stopEvent(e);$C.asyncRequest("POST"," /tips/close",{success:function(o){var res=MT.util.getEvalRes(o);if(res.status){$D.removeClass(document.body,"bg-newbie");_62.parentNode.style.display="none";}else{alert(res.msg);}},failure:function(o){}});});},addConsult:function(){var _66=$D.get("consult-add-succ");var _67=$D.get("consult-add-more");var _68=$D.get("consult-add-form");$E.on(_68,"submit",function(e){$E.stopEvent(e);var _6a=_68.question.value;var _6b=_68.dealid.value;if(!_6a){return alert("\u95ee\u9898\u4e0d\u80fd\u4e3a\u7a7a!");}var _6c="question="+_6a+"&dealid="+_6b;var _6d=$C.asyncRequest("POST",_68.action,{success:handleResponse,failure:function(o){}},_6c);});$E.on(_67,"click",function(e){$E.stopEvent(e);_68.style.display="block";_66.style.display="none";});function handleResponse(o){var res=MT.util.getEvalRes(o);if(res.status){_68.style.display="none";_66.style.display="block";MT.util.Effect.yellowFadeIn(_66);}else{alert(res.msg);}}},_voteDialog:null,getVoteDialog:function(){if(!this._voteDialog){var _72={width:"344px",fixedcenter:true,close:false,draggable:false,zindex:7,modal:true,visible:false};this._voteDialog=new YAHOO.widget.Panel("vote-start-dialog",_72);}return this._voteDialog;},startVoteDialog:function(_73,_74){var _75=this;$D.addClass(document.body,"yui-skin-sam");_gaq.push(["_trackPageview","/maillist/subscribed"]);showDialog();function showDialog(){var _76=_75.getVoteDialog();var _77=["<div class=\"vote-start-dialog-c\">"];_77.push("<h3><span id=\"vote-start-dialog-close\" class=\"close\">\u5173\u95ed</span></h3>");_77.push("<div class=\"succ\">");_77.push("<p class=\"title\">\u606d\u559c\u60a8<br />\u90ae\u4ef6\u8ba2\u9605\u6210\u529f\uff01</p>");if(_73){_77.push("<p class=\"notice\">"+_73+"\u6bcf\u5929\u7684\u56e2\u8d2d\u5c06\u53ca\u65f6\u53d1\u5230\u60a8\u90ae\u7bb1</p>");}_77.push("</div>");_77.push("<div class=\"vote\"><h4><a href=\"###\" style=\"display:none;\"></a><a id=\"vote-start-dialog-link\" href=\"/vote\" target=\"_blank\">\u60a8\u6700\u60f3\u56e2\u8d2d\u7684\u662f\u4ec0\u4e48\uff1f</a></h4><p class=\"text\">\u8bf7\u544a\u8bc9\u7f8e\u56e2\uff0c<br />\u8ba9\u7f8e\u56e2\u66f4\u597d\u7684\u4e3a\u60a8\u670d\u52a1\uff01</p><a class=\"link\" href=\"/vote\" target=\"_blank\">\u7acb\u5373\u53c2\u4e0e\u7528\u6237\u8c03\u67e5</a></div>");_77.push("</div>");_76.setBody(_77.join(""));_76.render(document.body);_76.show();$E.on("vote-start-dialog-close","click",function(e){_76.hide();});}},subscribe:function(_79,_7a,_7b,_7c){_79=$D.get(_79);_7a=$D.get(_7a);if(!_79||!_7a){return;}var _7d=_79.email;var _7e="\u8bf7\u8f93\u5165\u60a8\u7684Email...";if(_7d.value==""||_7d.value==_7e){_7d.style.color="#999999";_7d.value=_7e;}$E.on(_79,"submit",function(e){$E.stopEvent(e);if(_7d.value==""||_7d.value==_7e){return alert("\u8bf7\u8f93\u5165\u60a8\u7684Email\u5730\u5740\u3002");}$C.setForm(_79);var _80=$C.asyncRequest("POST",_79.action,{success:function(o){var res=MT.util.getEvalRes(o);if(res.status){MT.app.Deal.startVoteDialog(_7b);}else{if(res.data&&res.data.needCaptcha){window.location.href="/maillist/subscribe/"+_7c;}else{alert(res.msg);}}},failure:function(o){}});});$E.on(_7d,"focus",function(e){if(_7d.value==_7e){_7d.style.color="";_7d.value="";}});$E.on(_7d,"blur",function(e){if(_7d.value==""){_7d.style.color="#999999";_7d.value=_7e;}});}};MT.app.Deal.address=(function(){var _86,_87,_88,_89,_8a,_8b,_8c,_8d,_8e,_8f;var _90=null;var _91="\u8bf7\u6b63\u786e\u9009\u62e9\u5e02\u533a";var _92="\u90ae\u653f\u7f16\u7801\u586b\u5199\u6709\u8bef,\u8bf7\u8f93\u51656\u4f4d\u90ae\u653f\u7f16\u7801";var _93="\u8bf7\u586b\u5199\u8857\u9053\u5730\u5740\uff0c\u6700\u5c115\u4e2a\u5b57\uff0c\u6700\u591a\u4e0d\u80fd\u8d85\u8fc760\u4e2a\u5b57\uff0c\u4e0d\u80fd\u5168\u90e8\u4e3a\u6570\u5b57";var _94="\u8bf7\u6b63\u786e\u586b\u5199\u59d3\u540d\uff0c\u6700\u5c11\u4e0d\u80fd\u4f4e\u4e8e2\u4e2a\u5b57\uff0c\u6700\u591a\u4e0d\u80fd\u8d85\u8fc715\u4e2a\u5b57";var _95="\u7535\u8bdd\u53f7\u7801\u4e0d\u80fd\u5c11\u4e8e6\u4f4d";function getAttr(_96,_97){return (_96&&_96.getAttribute(_97))?_96.getAttribute(_97):"";}function checkDistrict(){if(_8a.value==""){_8b.innerHTML=_91;_8b.style.display="block";return false;}else{_8b.style.display="none";return true;}}function checkZipcode(){if(!_8c.value||!_8c.value.match(/^\d{6}$/)){_8b.innerHTML=_92;_8b.style.display="block";return false;}else{_8b.style.display="none";return true;}}function checkDetail(){if(!_88.value||(_88.value.length<5)||_88.value.match(/^\d*$/)){_89.innerHTML=_93;_89.style.display="block";return false;}else{_89.style.display="none";return true;}}function checkName(){if(!_86.value||(_86.value.length<2)||(_86.value.length>15)){_87.innerHTML=_94;_87.style.display="block";return false;}else{_87.style.display="none";return true;}}function checkPhone(){if(!_8d.value||!_8d.value.match(/^.{6,}$/)){_8e.innerHTML=_95;_8e.style.display="block";return false;}else{_8e.style.display="none";return true;}}function scrollToAddress(){window.scrollTo(0,$D.getY(_8f));}return {init:function(){_8f=$D.get("address-table");_86=$D.get("address-name");_87=$D.get("address-name-error");_88=$D.get("address-detail");_89=$D.get("address-detail-error");_8a=$D.get("address-district");_8b=$D.get("address-district-error");_8c=$D.get("address-zipcode");_8d=$D.get("address-phone");_8e=$D.get("address-phone-error");$E.on(_8a,"blur",function(e){checkDistrict();});$E.on(_8c,"blur",function(e){checkZipcode();});$E.on(_88,"blur",function(e){checkDetail();});$E.on(_86,"blur",function(e){checkName();});$E.on(_8d,"blur",function(e){checkPhone();});var _9d=$D.get("deal-buy-address-list");if(!_9d){return;}var _9e=_9d.getElementsByTagName("li");var _9f=_9d.getElementsByTagName("input");$D.batch(_9f,function(el){if(el.checked){_90=el.parentNode;$D.addClass(el.parentNode,"selected");}$E.on(el,"click",function(e){var _a2=this.parentNode;if(this.id=="deal-buy-address-other"){var _a3=getAttr(_9d,"sdealcity");var _a4=getAttr(_90,"scity");if(_a3==_a4){_86.value=getAttr(_90,"sname");_88.value=getAttr(_90,"saddress");_8c.value=getAttr(_90,"szipcode");_8d.value=getAttr(_90,"sphone");var _a5=getAttr(_90,"sdistrict");for(var i=0;i<_8a.options.length;i++){var _a7=_8a.options[i];if(_a7.value==_a5){_a7.selected=true;break;}}}else{_86.value="";_88.value="";_8c.value="";_8d.value="";_8a.options[0].selected=true;}$D.getElementsByClassName("blk-error","div","address-table",function(el){el.style.display="none";});$D.get("address-table").style.display="block";}else{$D.get("address-table").style.display="none";_90=_a2;}$D.removeClass(_9e,"selected");$D.addClass(_a2,"selected");});});},check:function(){var _a9=$D.get("deal-buy-form");var _aa=MT.util.getRadioValue(_a9,"addressid");if(!_8f||_aa>0){return true;}if(!checkDistrict()){scrollToAddress();return false;}if(!checkZipcode()){scrollToAddress();return false;}if(!checkDetail()){scrollToAddress();return false;}if(!checkName()){scrollToAddress();return false;}if(!checkPhone()){scrollToAddress();return false;}return true;}};})();})();